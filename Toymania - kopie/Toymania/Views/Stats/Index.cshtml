@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@*<li class="dropdown">
        <a href="#" data-toggle="dropdown" class="dropdown-toggle">
            A<b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li><a href="#" data-toggle="tab">A</a></li>
            <li><a href="#" data-toggle="tab">A</a></li>
        </ul>
    </li>*@


<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    @*<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">*@
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', { packages: ['corechart'] });
        google.charts.setOnLoadCallback(drawChart);
        google.load("visualization", "1", { packages: ["corechart"] });

        //https://developers.google.com/chart/interactive/docs/basic_load_libs
        //function drawChart() {
        //    // Define the chart to be drawn.
        //    var data = new google.visualization.DataTable();
        //    data.addColumn('string', 'Element');
        //    data.addColumn('number', 'Percentage');
        //    data.addRows([
        //        ['Nitrogen', 0.78],
        //        ['Oxygen', 0.21],
        //        ['Other', 0.01]
        //    ]);

        //    // Instantiate and draw the chart.
        //    var chart = new google.visualization.PieChart(document.getElementById('myPieChart'));
        //    chart.draw(data, null);
        //}
    </script>
</head>
<body>
    <br />
    <div class="container">
        @*<div class="row">
            <div class="col-xs-6">
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a href="#Linechart" data-toggle="tab">Linechart</a>
                    </li>
                    <li>
                        <a href="#Piechart" data-toggle="tab">Piechart</a>
                    </li>
                    <li>
                        <a href="#Diagram" data-toggle="tab">Diagram</a>
                    </li>


                </ul>
                <div class="tab-content">
                    <div id="Linechart" class="tab-pane active">
                        <select id="LCYSelector" onchange="">
                            <option value="2017">2017</option>
                            <option value="2018">2018</option>
                        </select>

                        <button id="LCYB">click meh</button>
                        <button type="button" id="OB">test2</button>
                        <p id="tp1">empty</p>

                        <div class="chart" style="width:80%; height:300px">

                        </div>
                    </div>
                    <div id="Piechart" class="tab-pane">
                        <p>piechart</p>
                    </div>
                    <div id="Diagram" class="tab-pane">
                        <p>diagram</p>
                    </div>
                </div>

            </div>
        </div>*@
        <select id="LCYSelector" onchange="">
            <option value="2017">2017</option>
            <option value="2018">2018</option>
        </select>

        <button id="LCYB">click meh</button>
        <button type="button" id="OB">test2</button>
        <p id="tp1">empty</p>

        <div class="chart" id="chart" style="width:80%; height:300px">

        </div>

    </div>
    <script type="text/javascript">

        var chartDataYear;
        var chartDataMonth;
        var chartDataDays;
        var GlobalYear;
        var CurrentReport;

        //var chartdataweek;
        //google.load("visualization", "1", { packages: ["corechart"] });


        $(document).ready(function () {

            $("#LCYB").click(function () {
                var year = $("#LCYSelector").val();
                $("#tp1").replaceWith(year);
                console.log(year);
            });
            $("#OB").on("click", info);

        });

        function info() {
            $.ajax({
                url: 'Stats/SalesDataYearWise',
                type: 'GET',
                dataType: 'json',
                data: {},
                success: function (d) {
                    chartDataYear = d;
                },
                error: function () {
                    alert("Error");
                }
            }).done(function () {
                CurrentReport = 'year';
                //GlobalYear = rowLevel;
                generateChart(chartDataYear, "chart year", selectYear);
            });
        }

        function generateChart(chartData, title, selectEvent) {
            var data = google.visualization.arrayToDataTable(chartData);

            var options = {
                title: title,
                pointSize: 5,
                focusTarget: "category",
                hAxis: { showTextEvery: 1 }
            }

            var lineChart = new google.visualization.LineChart(document.getElementById('chart'));
            if (selectEvent != null) {
                google.visualization.events.addListener(lineChart, 'select', function () {
                    selectEvent(lineChart, data);
                });
            }
            GenerateBack(CurrentReport);
            lineChart.draw(data, options);
        }

        function GenerateBack(currentReport) {
            $('.backButtonContainer').remove();
            //Create new Back Button
            if (currentReport != 'year') { //back button except year
                var $back = $('<button/>')
                            .text('Back')
                            .addClass('reportBack')
                            .click(function () {
                                switch (currentReport) {
                                    case 'month':
                                        CurrentReport = 'year';
                                        generateChart(chartDataYear, "Sales Report Data", selectYear);
                                        break;
                                    case 'days':
                                        CurrentReport = 'month';
                                        generateChart(chartDataMonth, "Sales Report Data of year " + GlobalYear, selectMonth);
                                        break;
                                    default:
 
                                }
                                $(this).parent().remove();
                            });
                var $div = $('<div/>')
                        .addClass('backButtonContainer')
                        .css({ 'width': '70%', 'text-align': 'right', 'padding': '5px' })
                        .append($back);
                $('#chart').before($div);
 
            }
        }

        function selectYear(chart, data) {
            var selectedItem = chart.getSelection()[0];
            if (selectedItem) {
                var rowLevel = parseInt(data.getValue(selectedItem.row, 0));
                var rl = rowLevel.toString();
                //var year = new Date(rowLevel, 2)
                var chartData = null;
                $.ajax({
                    url: '/Stats/SalesDataMonthWise', //DataWeekWise
                    type: 'get',
                    dataType: 'json',
                    data: { 'y': rowLevel },
                    success: function (d) {
                        chartDataMonth = d;
                    },
                    error: function () {
                        alert("Error")
                    }
                }).done(function () {
                    CurrentReport = 'month';
                    GlobalYear = rowLevel;
                    generateChart(chartDataMonth, "chart year" +" " + rl, selectMonth);
                });
            }
        }

        function selectMonth(chart, data) {
            //month event(after select month data from chart)
            var selectedItem = chart.getSelection()[0];
            if (selectedItem) {
                var rowLevel = data.getValue(selectedItem.row, 0);
                $.ajax({
                    url: '/Stats/SalesDataDayWise',
                    type: 'get',
                    dataType: 'json',
                    data: { 'y': GlobalYear, 'm': rowLevel },
                    succes: function (d) {
                        chartDataDays = d
                    },
                    error: function () {
                        alert("error!")
                    }
                }).done(function () {
                    CurrentReport = "days";
                    generateChart(chartDataDays, "Chart" + rowLevel + " " + GlobalYear, null);
                });
            }
        }



    </script>
</body>
</html>




















